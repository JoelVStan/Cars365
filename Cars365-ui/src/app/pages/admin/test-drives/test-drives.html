<h4 class="mb-3">
  <i class="bi bi-calendar-check"></i>
  Test Drive Requests
</h4>

@if (loading) {
  <div class="spinner-border text-primary"></div>
}

@if (!loading && testDrives.length === 0) {
  <p class="text-muted">No test drive requests.</p>
}

@if (testDrives.length > 0) {

<table class="table table-hover align-middle">
  <thead>
    <tr>
      <th>Car</th>
      <th>User</th>
      <th>Phone</th>
      <th>Date</th>
      <th>Time</th>
      <th>Status</th>
      <th width="220">Action</th>
    </tr>
  </thead>

  <tbody>
    @for (td of testDrives; track td.id) {
      <tr>

        <td>
          {{ td.car.year }} {{ td.car.brand }} {{ td.car.model }}
        </td>

        <td>
          {{ td.user.fullName }}
        </td>

        <td>
          {{ td.user.phoneNumber }}
        </td>

        <td>
          {{ td.preferredDate | date:'mediumDate' }}
        </td>

        <td>
          {{ td.timeSlot }}
        </td>

        <td>
          <span class="badge"
                [ngClass]="{
                  'bg-warning': td.status === 'Pending',
                  'bg-success': td.status === 'Approved',
                  'bg-danger': td.status === 'Rejected',
                  'bg-secondary': td.status === 'Completed'
                }">
            {{ td.status }}
          </span>
        </td>

        <td>

          @if (td.status === 'Pending') {
            <button class="btn btn-sm btn-success me-1"
                    (click)="approve(td)">
              Approve
            </button>

            <button class="btn btn-sm btn-outline-danger"
                    (click)="reject(td)">
              Reject
            </button>
          }

          @if (td.status === 'Approved') {
            <button class="btn btn-sm btn-outline-primary"
                    (click)="complete(td)">
              Mark Completed
            </button>
          }

        </td>

      </tr>
    }
  </tbody>
</table>
}
