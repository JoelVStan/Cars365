@if (loading) {
  <div class="text-center mt-5">
    <div class="spinner-border text-primary"></div>
  </div>
}

@if (!loading && car) {
  <div class="car-details-page">

    <div class="row g-4">

      <!-- LEFT: IMAGE + BADGES -->
      <div class="col-lg-7">

        <div class="image-card position-relative">

          <!-- Main Image -->
          <img
            [src]="selectedImage"
            class="img-fluid car-hero-img"
            alt="Car image"
          />

          <!-- Arrows -->
          @if (galleryImages.length > 1) {
            <button class="nav-arrow left" (click)="prevImage()">
              <i class="bi bi-chevron-left"></i>
            </button>

            <button class="nav-arrow right" (click)="nextImage()">
              <i class="bi bi-chevron-right"></i>
            </button>
          }

          <!-- Trust badge -->
          <span class="badge trust-badge">
            Cars365 Guaranteed
          </span>

        </div>

        <!-- Thumbnails -->
        @if (galleryImages.length > 1) {
          <div class="thumbnail-strip mt-3">
            @for (img of galleryImages; track img.id; let i = $index) {
              <img
                [src]="img.fullUrl"
                class="thumb"
                [class.active]="i === currentIndex"
                (click)="selectImage(i)"
              />
            }
          </div>
        }

        <!-- Detailed Specs (Below Image) -->
        <div class="detail-specs mt-3 mb-3">

          <div class="detail-item">
            <i class="bi bi-speedometer2"></i>
            <div>
              <span class="label">Kms Driven</span>
              <span class="value">{{ car.kmsDriven | number }} km</span>
            </div>
          </div>

          <div class="detail-item">
            <i class="bi bi-person-badge"></i>
            <div>
              <span class="label">Ownership</span>
              <span class="value">
                {{ car.ownership }}{{ getOwnershipSuffix(car.ownership) }} Owner
              </span>
            </div>
          </div>

          <div class="detail-item">
            <i class="bi bi-credit-card-2-front"></i>
            <div>
              <span class="label">Registration</span>
              <span class="value">{{ car.registrationCode }}</span>
            </div>
          </div>

          <div class="detail-item">
            <i class="bi bi-calendar-event"></i>
            <div>
              <span class="label">Make Year</span>
              <span class="value">{{ car.year }}</span>
            </div>
          </div>

          <div class="detail-item">
            <i class="bi bi-calendar2-check"></i>
            <div>
              <span class="label">Registration Date</span>
              <span class="value">
                {{ car.registrationYear | date:'MMM yyyy' }}
              </span>
            </div>
          </div>

          @if (car.fuelType != 'Electric') {
            <div class="detail-item">
            <i class="bi bi-gear-wide-connected"></i>
            <div>
              <span class="label">Engine</span>
              <span class="value">{{ car.engineCC }} cc</span>
            </div>
          </div>}
          

          <div class="detail-item">
            <i class="bi bi-shield-check"></i>
            <div>
              <span class="label">Insurance Till</span>
              <span class="value">
                {{ insuranceDisplay(car.insuranceTill) }}
              </span>
            </div>
          </div>

          <div class="detail-item">
            <i class="bi bi-key"></i>
            <div>
              <span class="label">Spare Key</span>
              <span
                class="value"
                [class.text-success]="car.hasSpareKey"
                [class.text-danger]="!car.hasSpareKey"
              >
                {{ car.hasSpareKey ? 'Available' : 'Not Available' }}
              </span>
            </div>
          </div>

        </div>


      </div>

      <!-- RIGHT: DETAILS -->
      <div class="col-lg-5">

        <div class="details-card">

          <!-- Title -->
          <h3 class="car-title">
            {{ car.year }} {{ car.brand }} {{ car.model }}
          </h3>

          <p class="text-muted mb-3">
            {{ car.type }}
          </p>

            <div class="sticky-price-card">

                <div class="price-box mb-2">
                    ₹ {{ formatPriceToLakhs(car.price) }}
                </div>

                @if (car.price > 300000) {
                <div class="emi-box">
                    EMI starts at
                    <strong>
                    ₹ {{ calculateEmi(car.price) | number }}
                    </strong>
                    / month*
                </div>
                }

            </div>


          <!-- Specs -->
          <div class="spec-grid mb-4 mt-4">
            <div class="spec-item">
              <i class="bi bi-fuel-pump"></i>
              <span>{{ car.fuelType }}</span>
            </div>

            <div class="spec-item">
              <i class="bi bi-gear"></i>
              <span>{{ car.transmission }}</span>
            </div>

            <div class="spec-item">
              <i class="bi bi-car-front"></i>
              <span>{{ car.type }}</span>
            </div>
          </div>

          <!-- Description -->
          <div class="description-box mb-4">
            <h6>About the vehicle</h6>
            <p>
              {{ car.description || 'Well maintained car with a smooth driving experience.' }}
            </p>
          </div>

          <!-- WHY BUY -->
            <div class="why-buy-card mt-4">
            <h6>Why buy from Cars365?</h6>

            <ul>
                <li>
                <i class="bi bi-shield-check"></i>
                Verified & quality-checked cars
                </li>
                <li>
                <i class="bi bi-currency-rupee"></i>
                Transparent pricing & no hidden charges
                </li>
                <li>
                <i class="bi bi-arrow-repeat"></i>
                Hassle-free ownership transfer
                </li>
                <li>
                <i class="bi bi-headset"></i>
                Dedicated customer support
                </li>
            </ul>
            </div>


          <!-- Actions -->
          <div class="action-buttons">
            <button class="btn btn-dark w-100 mb-2">
              Contact Seller
            </button>

            <button
              class="btn btn-outline-secondary w-100"
              routerLink="/cars"
            >
              ← Back to Cars
            </button>
          </div>

        </div>

      </div>

    </div>
  </div>
}
